### **Chrome 扩展 API vs. 网页 JavaScript：功能差异详解 (第一部分)**

#### **一、 跨标签页与浏览器窗口管理 (Cross-Tab & Browser Window Management)**

网页 JavaScript 的生命周期和作用域被严格限制在它所在的单个标签页内，无法感知或操作其他标签页或浏览器窗口。扩展 API 则拥有全局视野。

*   **`chrome.tabs` - 跨标签页控制**
    网页 JS 无法操作自身以外的标签页。此 API 可以管理所有浏览器标签页，如创建、查询、移动、关闭、分组，实现跨页面的自动化和信息整合。

*   **`chrome.windows` - 浏览器窗口控制**
    网页 JS 无法控制浏览器窗口。此 API 能创建、查询、移动和关闭浏览器窗口，并监听窗口事件，用于窗口布局管理或多窗口应用。

*   **`chrome.scripting.executeScript` - 跨域脚本注入**
    网页 JS 无法向其他域的页面注入代码。此 API 允许扩展向任意标签页（需权限）动态注入并执行 JavaScript 代码，是实现页面增强、自动化操作的核心。

*   **`chrome.scripting.insertCSS` - 跨域样式注入**
    网页 JS 无法向其他域的页面注入样式。此 API 允许扩展向任意标签页（需权限）注入 CSS，可以自定义任何网站的显示风格，如实现夜间模式或内容优化。

*   **`chrome.tabGroups` - 标签页分组管理**
    网页 JS 无法感知或操作标签组。此 API 允许扩展创建、查询、更新和移动标签组，为用户提供高级的标签页组织能力，提升浏览效率。

*   **`chrome.sessions` - 恢复关闭的会话**
    网页 JS 无法访问已关闭的标签。此 API 可以查询和恢复最近关闭的标签页与窗口，是会话管理工具的核心，能防止意外关闭导致数据丢失。

*   **`chrome.pageCapture` - 页面完整存档**
    网页 JS 无法将页面保存为单个文件。此 API 可以将一个完整的标签页（包括所有子框架）保存为 MHTML 文件，实现网页的离线归档。

*   **`chrome.desktopCapture` - 屏幕/窗口/标签页内容捕获**
    网页 JS 的屏幕捕获 API (`getDisplayMedia`) 需要用户每次手动选择。此 API 经一次授权后，能以编程方式捕获屏幕、特定窗口或标签页的内容流，用于录屏或直播。

#### **二、 浏览器 UI 界面定制 (Browser UI Customization)**

网页 JavaScript 只能在页面的 `<body>` 区域内渲染 UI，无法触及浏览器本身的任何界面元素。扩展则可以直接在浏览器“框架”上创建交互界面。

*   **`chrome.action` - 工具栏图标交互**
    网页 JS 无法在浏览器工具栏创建任何 UI。此 API 控制扩展在工具栏的图标，包括设置图标、标题、徽章（badge）和弹出页面（popup），是核心交互入口。

*   **`chrome.contextMenus` - 自定义右键菜单**
    网页 JS 无法修改浏览器右键菜单。此 API 允许向右键上下文菜单添加自定义项，可针对页面、链接、图片等不同元素，并响应点击事件，提供便捷操作。

*   **`chrome.omnibox` - 地址栏命令交互**
    网页 JS 无法与地址栏交互。此 API 允许扩展注册一个关键词，用户在地址栏输入关键词后，可提供实时建议或触发搜索功能，实现快速命令调用。

*   **`chrome.sidePanel` - 创建浏览器侧边栏**
    网页 JS 无法在浏览器侧边栏创建持久 UI。此 API 允许扩展打开一个常驻的侧边栏界面，方便用户在浏览网页时同时与扩展进行复杂交互。

*   **`chrome.commands` - 注册全局快捷键**
    网页 JS 定义的快捷键仅在页面获得焦点时生效。此 API 允许为扩展的核心功能注册全局键盘快捷键，用户可以在任何页面触发扩展操作，极大提升操作效率。

*   **`chrome.declarativeContent` - 基于页面内容激活图标**
    网页 JS 无法根据页面内容动态控制浏览器 UI。此 API 允许声明规则，仅当页面 URL 或内容满足条件时才激活扩展的工具栏图标，减少不必要的干扰。

#### **三、 网络请求的深度控制与观测 (Deep Control & Observation of Network Requests)**

网页 JavaScript 的 `fetch` API 受同源策略（CORS）和安全限制，且只能观测自身发起的请求。扩展 API 则能像“中间人”一样监控和修改浏览器的所有网络流量。

*   **`chrome.declarativeNetRequest` - 声明式网络请求拦截**
    网页 JS 只能发起请求，无法拦截。此 API 通过声明式规则集，在请求发生前高效地拦截、阻止、重定向或修改网络请求头，是现代广告拦截和安全防护的核心。

*   **`chrome.webRequest` - 动态网络请求观测与修改**
    相比 `declarativeNetRequest`，此 API（主要在 MV2 中）能更动态地在请求生命周期的各个阶段观察、分析甚至同步修改网络流量，功能更灵活但性能开销更大。

*   **`chrome.proxy` - 编程化代理设置**
    网页 JS 无法配置系统代理。此 API 允许扩展管理 Chrome 的代理设置，可以编程方式指定代理服务器来处理所有网络请求，是网络代理工具的基础。

*   **`chrome.cookies` - 跨域 Cookie 管理**
    网页 JS 受同源策略限制，只能访问本站 Cookie。此 API 可以跨域查询、设置和删除任意网站的 Cookie，并能监听其变化，用于身份管理或自动化测试。

*   **`chrome.webNavigation` - 导航状态监控**
    网页 JS 只能监听本页面的导航事件。此 API 可以监听所有标签页的导航状态，如导航开始、完成、发生错误等事件，用于分析页面加载流程或实现跳转逻辑。

#### **四、 增强的本地与云端存储 (Enhanced Local & Cloud Storage)**

网页 JavaScript 的存储（`localStorage`, `IndexedDB`）与网站绑定，可能被用户清除。扩展存储则拥有独立的生命周期和更强的功能。

*   **`chrome.storage.sync` - 跨设备同步存储**
    网页 JS 的存储是设备本地的。此 API 提供了一个键值对存储区，其数据会自动通过用户的 Google 账户在所有登录的设备间同步，非常适合存储用户配置。

*   **`chrome.storage.local` - 持久化扩展存储**
    网页 JS 的 `localStorage` 容易被清除。此 API 提供了更大容量、性能更好的本地存储，它与扩展绑定而非网站，生命周期更长，更适合存储应用数据。

*   **`chrome.storage.managed` - 企业策略配置存储**
    网页 JS 无法接收管理员配置。此 API 是一个只读存储区，允许企业管理员通过策略为所有员工统一下发配置信息，用于企业级扩展的集中管理。

#### **五、 系统级与硬件设备交互 (System-level & Hardware Device Interaction)**

现代 Web API（如 WebUSB, WebSerial）正在逐步开放硬件访问，但仍需用户在页面上进行繁琐的授权。扩展 API 提供了更直接、更强大的硬件访问能力。

*   **`chrome.alarms` - 后台定时任务**
    网页 JS 的 `setTimeout` 在页面关闭后即失效。此 API 提供了一个调度器，即使扩展的后台 Service Worker 处于休命状态，也能在指定时间或周期性地唤醒它执行代码。

*   **`chrome.nativeMessaging` - 与本地应用通信**
    这是最根本的突破：网页 JS 绝对无法与本地程序交互。此 API 允许扩展启动并与用户计算机上安装的原生应用程序进行双向通信，实现浏览器与操作系统的桥接。

*   **`chrome.downloads` - 全功能下载管理**
    网页 JS 只能触发下载，无法管理。此 API 提供了与浏览器下载管理器交互的全面功能，可以启动、监控、暂停、取消和搜索下载项，甚至打开已下载文件。

*   **`chrome.hid` / `chrome.usb` / `chrome.serial` - 底层硬件通信**
    相比网页版的 Web API，这些扩展 API 提供了更广泛的设备支持和更底层的控制能力，允许与非标准键盘、游戏手柄、USB 加密狗、串口设备等进行深度交互。

*   **`chrome.power` - 系统电源管理**
    网页 JS 无法阻止系统休眠。此 API 允许扩展请求系统保持唤醒状态（如阻止屏幕关闭或系统睡眠），在执行视频播放、数据计算等重要任务时非常有用。

*   **`chrome.system.cpu/memory/storage` - 系统信息查询**
    网页 JS 无法获取详细的系统硬件信息。这些 API 提供了查询 CPU、内存和存储设备（如硬盘、U盘）的元数据和使用情况的能力，可用于性能监控工具。

#### **六、 浏览器核心数据访问 (Access to Core Browser Data)**

网页 JavaScript 无法访问浏览器存储的用户个人数据，如书签、历史记录等。扩展则可以像一个浏览器助手一样，帮助用户管理这些核心数据。

*   **`chrome.bookmarks` - 书签管理**
    网页 JS 无法访问或修改用户的书签收藏。此 API 允许扩展创建、读取、修改和组织用户的书签及文件夹，是所有书签管理类扩展的基础。

*   **`chrome.history` - 浏览历史访问**
    网页 JS 只能操作当前页面的会话历史 (`history` 对象)，无法读取全局历史。此 API 提供了对浏览器全部历史记录的访问权限，可以查询、添加、删除条目。

*   **`chrome.topSites` - 访问最常访问的网站**
    网页 JS 无法获知用户的浏览习惯。此 API 允许扩展访问用户在新标签页上显示的最常访问的网站列表，可用于构建自定义的快速启动页面。

*   **`chrome.readingList` - 与阅读清单交互**
    网页 JS 无法与 Chrome 内置的“阅读清单”功能交互。此 API 允许扩展添加、查询、更新和移除阅读清单中的条目，能将内容保存与管理功能深度集成。

*   **`chrome.management` - 管理其他扩展和应用**
    网页 JS 完全无法感知其他扩展的存在。此 API 提供了管理已安装扩展、应用和主题的功能，例如启用、禁用、卸载或获取信息，是扩展管理工具的核心。

#### **七、 隐私与安全控制 (Privacy & Security Control)**

网页 JavaScript 只能遵守浏览器设定的隐私和安全策略，无法反向控制它们。扩展则可以在一定程度上读取和修改这些全局设置。

*   **`chrome.browsingData` - 清除全局浏览数据**
    网页 JS 只能清除与自己来源相关的数据。此 API 允许扩展清除用户的全局浏览数据，如整个浏览器的缓存、历史记录、Cookie、密码等，常用于隐私清理工具。

*   **`chrome.privacy` - 读写浏览器隐私设置**
    网页 JS 无法影响浏览器的核心隐私设置。此 API 允许扩展读取和修改 Chrome 的隐私相关设置，例如是否启用网络预测、安全浏览、拼写服务等。

*   **`chrome.contentSettings` - 控制网站内容权限**
    网页 JS 无法决定其他网站能做什么。此 API 允许扩展为特定网站或全局设置内容权限，如是否允许运行 JavaScript、显示图片、使用 Cookie 等，实现精细化控制。

*   **`chrome.enterprise.platformKeys` - 企业级证书管理**
    网页 JS 无法访问硬件安全模块。此 API 用于在企业环境中管理硬件支持的客户端证书，允许扩展与 TPM 等安全硬件交互，用于高级别的身份认证。

#### **八、 身份认证与权限管理 (Identity & Permission Management)**

扩展 API 提供了更流畅、更集成的身份验证流程，并拥有一套独立的权限请求模型，这是网页所不具备的。

*   **`chrome.identity` - 流畅的 OAuth2 认证**
    网页 JS 进行 OAuth2 认证通常需要弹出新窗口和页面重定向。此 API 提供了集成的认证流程，能以非侵入式的方式获取用户身份令牌，体验更佳且更安全。

*   **`chrome.permissions` - 动态请求可选权限**
    网页的权限模型（如地理位置）是基于单次请求的。此 API 允许扩展在运行时向用户请求更广泛的可选权限（如访问所有网站数据），替代在安装时请求所有权限，提升用户信任度。

#### **九、 开发者工具与调试扩展 (Developer Tools & Debugging Extensions)**

网页 JavaScript 是被调试的对象，它自身无法扩展开发者工具。扩展 API 则可以将开发者工具本身作为平台，为其添加新功能。

*   **`chrome.devtools.panels` - 创建新的开发者工具面板**
    网页 JS 无法在开发者工具中创建任何 UI。此 API 允许扩展向开发者工具窗口添加新的、功能齐全的面板，与 "Elements"、"Console" 面板并列。

*   **`chrome.devtools.inspectedWindow` - 与被检查窗口交互**
    网页 JS 无法命令浏览器。此 API 允许 DevTools 扩展与被检查的页面进行交互，如获取其 tabId、执行代码、重新加载页面，是连接扩展与页面的桥梁。

*   **`chrome.devtools.network` - 访问网络请求详情**
    网页 JS 无法获取非自身发起的网络请求的详细 HAR 日志。此 API 允许扩展访问“Network”面板记录的所有网络请求的详细信息，用于网络分析工具。

*   **`chrome.debugger` - 作为远程调试器附加到标签页**
    这是最强大的调试 API，网页 JS 望尘莫及。它允许扩展附加到任意标签页，通过 Chrome DevTools Protocol (CDP) 完全控制该页面，可以监听事件、修改 DOM、调试 JS 等。

*   **`chrome.processes` - 监控浏览器进程**
    网页 JS 无法了解浏览器的内部进程。此 API 允许扩展获取浏览器内部各个进程（如标签页、扩展自身）的信息，包括 CPU 和内存使用情况，用于性能监控。

#### **十、 输入、无障碍与国际化 (Input, Accessibility & Internationalization)**

这类 API 提供了超越单个页面的、与浏览器或操作系统集成的辅助功能和输入能力。

*   **`chrome.i18n` - 扩展自身国际化**
    网页 JS 的国际化方案服务于页面内容。此 API 服务于扩展本身，允许根据用户的浏览器语言，从 `_locales` 目录加载不同的字符串，实现扩展 UI 的多语言支持。

*   **`chrome.input.ime` - 实现自定义输入法**
    网页 JS 无法创建系统级的输入法。此 API 允许扩展实现一个完整的输入法编辑器（IME），可在整个操作系统中使用（主要在 ChromeOS），用于创建新的语言输入工具。

*   **`chrome.tts` / `chrome.ttsEngine` - 提供或成为语音引擎**
    网页的 Web Speech API 只能使用已有的语音。`chrome.tts` 提供了更稳定的跨平台文本转语音能力，而 `chrome.ttsEngine` 允许扩展注册自身为一个新的语音引擎，供其他应用调用。

*   **`chrome.automation` - 访问无障碍树**
    网页 JS 只能访问自己的 DOM 树。此 API 提供了访问和操作页面可访问性树（Accessibility Tree）的能力，这是开发屏幕阅读器等辅助技术的关键，可以“看到”页面的语义结构。

#### **十一、 操作系统深度集成 (Deep OS Integration - Primarily ChromeOS)**

这些 API（主要用于 ChromeOS）彻底打破了浏览器和操作系统的界限，赋予了扩展近乎原生应用的能力，这是网页 JS 绝对无法企及的。

*   **`chrome.fileSystemProvider` - 创建虚拟文件系统**
    网页 JS 的 File System Access API 只能操作用户选择的文件。此 API 允许扩展实现一个完整的虚拟文件系统，并将其挂载到操作系统的文件管理器中（如 Google Drive 集成）。

*   **`chrome.vpnProvider` - 实现 VPN 客户端**
    网页 JS 无法处理系统网络流量。此 API 允许扩展实现一个 VPN 客户端，可以配置和管理一个系统级的 VPN 连接，处理来自操作系统的所有网络流量。

*   **`chrome.wallpaper` - 更改桌面壁纸**
    网页 JS 无法修改任何操作系统级别的 UI。此 API 允许扩展更改 ChromeOS 的桌面壁纸，实现动态壁纸或壁纸管理功能。

*   **`chrome.networking.config` - 配置网络连接**
    网页 JS 无法配置设备的网络。此 API 允许扩展配置设备上的网络连接（如 Wi-Fi、蜂窝网络），通常与企业策略配合使用，用于在受管设备上分发网络凭据。

*   **`chrome.offscreen` - 运行不可见的 DOM 环境**
    在 MV3 中，后台 Service Worker 无法访问 DOM。网页 JS 本身就是 DOM 环境。此 API 允许扩展创建一个在后台运行的、不可见的文档，以解决 Service Worker 无法使用剪贴板、音频等 DOM API 的问题。

#### **十二、 高级媒体与内容交互 (Advanced Media & Content Interaction)**

除了注入脚本和样式，扩展还能以更底层的方式与标签页的内容流进行交互，这是网页 JavaScript 无法对其他页面做到的。

*   **`chrome.tabCapture` - 捕获标签页音视频流**
    网页 JS 无法捕获另一个标签页的媒体内容。此 API 可以捕获特定标签页的音频和视频，并将其作为媒体流。这是实现标签页录制、音视频分析或内容串流功能的核心。

*   **`chrome.favicon` - 跨域访问网站图标**
    网页 JS 无法直接获取任意网站的 favicon。这个实验性 API 允许扩展访问和操作与任何 URL 关联的网站图标（favicon），可用于自定义书签管理器或历史记录视图。

*   **`chrome.search` - 以编程方式搜索**
    网页 JS 只能通过构造 URL 来跳转到搜索引擎。此 API 允许扩展通过编程方式，直接使用浏览器配置的默认搜索引擎进行搜索，并在新标签页中打开结果，实现了更原生的集成。

#### **十三、 专用硬件与外设交互 (Specialized Hardware & Peripherals Interaction)**

除了通用的 USB/HID 设备，扩展 API 还提供了与特定类型专用硬件交互的能力，这些领域通常是网页标准尚未覆盖的。

*   **`chrome.documentScan` - 与文档扫描仪通信**
    网页 JS 没有任何标准可以与扫描仪交互。此 API 提供了发现并从连接到计算机的文档扫描仪获取图像的功能，允许扩展构建功能完善的文档扫描和管理应用。

*   **`chrome.printing` (仅 ChromeOS)**
    网页 JS 的 `window.print()` 总是会弹出系统打印对话框。此 API 提供了一个向已连接打印机直接提交打印作业的编程接口，常用于无需用户干预的自助服务终端（Kiosk）应用。

*   **`chrome.printerProvider` (仅 ChromeOS)**
    网页 JS 无法扩展操作系统的打印能力。此 API 允许扩展实现一个虚拟的打印机驱动程序，可以发现网络打印机、查询其能力并将打印作业发送给它们，极大地扩展了 ChromeOS 的打印支持范围。

#### **十四、 操作系统服务与 UI 集成 (OS Services & UI Integration - Primarily ChromeOS)**

在 ChromeOS 上，扩展的能力被进一步放大，可以直接与操作系统核心服务和界面组件集成，其行为与原生应用无异。

*   **`chrome.fileBrowserHandler` (仅 ChromeOS)**
    网页 JS 无法与操作系统的文件管理器集成。此 API 允许扩展在 ChromeOS 的文件管理器中注册自定义操作，例如，当用户右键点击文件时，可以出现“用我的扩展编辑”的选项。

*   **`chrome.loginState` (仅 ChromeOS)**
    网页 JS 完全无法感知用户的操作系统登录状态。此 API 可以检测用户是否已登录到 ChromeOS、登录用户的类型（如普通用户、访客）等信息，用于需要根据用户身份调整行为的应用。

*   **`chrome.system.display` - 管理显示器信息**
    网页 JS 的 Screen API 只能读取显示器信息。此 API 不仅能查询每个显示器的详细属性（分辨率、边界），更重要的是，在 ChromeOS 上它还能够动态修改这些设置。

*   **`chrome.mdns` - 发现本地网络服务**
    出于安全考虑，网页 JS 无法随意扫描本地网络。此 API 允许扩展发现本地网络上通过 mDNS/DNS-SD 广播的服务（如网络打印机、智能家居设备），实现局域网内的设备互联。

#### **十五、 底层安全与认证 (Low-level Security & Authentication)**

扩展 API 能够触及浏览器更底层的安全机制，承担起普通网页无法扮演的可信角色。

*   **`chrome.certificateProvider` - 提供 TLS 客户端证书**
    网页 JS 无法管理或提供用于网络认证的证书。此 API 允许扩展作为一个证书提供者，向平台（如 ChromeOS）提供 TLS 客户端证书，用于需要证书进行身份验证的企业网络或安全服务。

*   **`chrome.platformKeys` - 访问平台管理的证书**
    网页 JS 无法访问硬件安全模块中的密钥。此 API 提供了访问由平台（如 ChromeOS 上的 TPM 芯片）管理的 TLS 客户端证书和密钥的功能，可用于实现高度安全的网络认证。

#### **十六、 已废弃但具代表性的强大 API (Deprecated but Representative Powerful APIs)**

以下 API 虽然已被废弃或功能受限，但它们清晰地展示了扩展曾经拥有的、远超网页 JS 的强大能力，也反映了平台向更安全、更标准化的方向演进的趋势。

*   **`chrome.fontSettings` (已废弃)**
    网页 JS 只能控制自己页面内的字体。此 API 曾允许扩展读取甚至修改整个浏览器的全局字体设置，由于潜在的指纹识别风险，此功能已被移除。

*   **`chrome.gcm` (Google Cloud Messaging) (已废弃)**
    网页 JS 的消息推送依赖于现代的 Web Push 标准。此 API 曾是 Chrome 独有的、与 Google 云消息服务深度集成的推送方案，允许服务器直接向扩展推送消息。

*   **`chrome.app.window` & `chrome.app.runtime` (仅限 Chrome App)**
    网页 JS 始终运行在浏览器标签页内。这些为 Chrome 应用设计的 API 曾允许创建独立于浏览器的、拥有自定义边框（甚至无边框）的窗口，并管理其应用生命周期，使其外观和行为与原生桌面应用几乎无法区分。
